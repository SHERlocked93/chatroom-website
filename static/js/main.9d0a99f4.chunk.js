(this["webpackJsonpchatroom-website"]=this["webpackJsonpchatroom-website"]||[]).push([[0],{116:function(e,t,a){e.exports={container:"login_container__3f4Dd",tab:"login_tab__6X2QU"}},162:function(e,t,a){e.exports={container:"settingBar_container__3bH6-"}},169:function(e,t,a){e.exports={container:"groupInfo_container__2fUdm"}},170:function(e,t,a){e.exports={container:"chattingPanel_container__2h4qb"}},171:function(e,t,a){e.exports={container:"typewritingPanel_container__2QNxo"}},194:function(e,t,a){},360:function(e,t,a){"use strict";a.r(t);var n,r=a(0),o=a.n(r),c=a(10),s=a.n(c),i=a(112),l=a.n(i),m=(a(193),a(194),a(44)),u=a(162),d=a.n(u),f=a(11),b=a(70),h=a(22),p="cw-user-info",v="user-send-message-res",E=a(163),g="http://localhost:3090",O={chatroomInfoList:[],currentChatroom:null,userInfo:JSON.parse(null!==(n=sessionStorage.getItem(p))&&void 0!==n?n:"{}"),socket:Object(E.io)(g,{transports:["websocket","xhr-polling","jsonp-polling"]})},j="RESET_USER_INFO",_="CHANGE_CHATROOM",I="CHATROOM_INFO_LIST",C="USER_LOGIN",y="NEW_MESSAGE",w=function(e,t){var a;switch(t.type){case j:return sessionStorage.removeItem(p),Object(h.a)(Object(h.a)({},e),{},{userInfo:{uid:null,username:null}});case _:var n=null!==(a=e.chatroomInfoList.find((function(e){return e.id===t.payload.chatroomId})))&&void 0!==a?a:null;return Object(h.a)(Object(h.a)({},e),{},{currentChatroom:n});case I:return Object(h.a)(Object(h.a)({},e),t.payload);case y:var r=e.chatroomInfoList,o=e.currentChatroom,c=t.payload,s=c.chatroomId,i=c.newMessage,l=r.find((function(e){return e.id===s}));if(!l||!o)return e;var m=function(e,t){var a=e.findIndex((function(e){return e===t}));if(a<0)throw new Error("\u8fd9\u4e2a\u6570\u7ec4\u91cc\u6ca1\u6709\u8fd9\u4e2a\u5143\u7d20");var n=Object(b.a)(e);return n.splice(a,1),n}(r,l),u=Object(h.a)(Object(h.a)({},l),{},{messageList:[].concat(Object(b.a)(l.messageList),[i])});return o.id===s?Object(h.a)(Object(h.a)({},e),{},{chatroomInfoList:[u].concat(Object(b.a)(m)),currentChatroom:u}):Object(h.a)(Object(h.a)({},e),{},{chatroomInfoList:[u].concat(Object(b.a)(m))});case C:var d=t.payload.userInfo;return d&&sessionStorage.setItem(p,JSON.stringify(d)),Object(h.a)(Object(h.a)({},e),{},{userInfo:d});default:return e}},N=o.a.createContext(O),x=o.a.createContext((function(){})),k=function(e){var t=Object(f.e)(),a=(Object(r.useContext)(N),Object(r.useContext)(x));return o.a.createElement("div",{className:d.a.container},o.a.createElement("div",{className:"top-btns"},o.a.createElement("div",{className:"top-btn",onClick:function(){a({type:j}),t.push("/login")}}),o.a.createElement("div",{className:"top-btn"}),o.a.createElement("div",{className:"top-btn"})))},L=a(71),S=a.n(L),P=a(164),F=a.n(P),M=a(364),T=a(32),R=Object(T.b)(),q=F.a.create({baseURL:g,timeout:5e3});q.interceptors.request.use((function(e){return e}),(function(e){return console.error("Error in fetch.ts:  ",e),Promise.reject(e)})),q.interceptors.response.use((function(e){var t=e.data,a=t.code,n=t.data,r=t.message;e.config;return[2e4].includes(a)?n:(M.b.error("Error in fetch.js respone interceptors:  "+r),40001===a&&R.push("/login"),Promise.reject(new Error(r)))}),(function(e){return e.message="\u7f51\u7edc\u901a\u8baf\u5f02\u5e38\uff0c\u8bf7\u68c0\u67e5\uff01",Promise.reject(e)}));var A=q.request,U=o.a.memo((function(e){var t=e.name,a=e.recentMessage,n=e.id,r=e.recentMessageUsername,c=e.isActive,s=e.handleChangeChatroom;return o.a.createElement("div",{className:"".concat(S.a.chatroomItem," ").concat(c?S.a["is-active"]:""),onClick:function(){return s(n)}},o.a.createElement("div",{className:S.a.header},t),o.a.createElement("div",{className:S.a.content},r,"\uff1a ",a))})),H=function(){var e=Object(r.useContext)(N),t=Object(r.useContext)(x),a=Object(r.useState)([]),n=Object(m.a)(a,2),c=n[0],s=n[1],i=Object(r.useCallback)((function(e){t({type:_,payload:{chatroomId:e}})}),[]);return Object(r.useEffect)((function(){A({method:"get",url:"/chatroom/info-list"}).then((function(e){t({type:I,payload:{chatroomInfoList:e,currentChatroom:e.length?e[0]:null}})}))}),[]),Object(r.useEffect)((function(){e.socket.on(v,(function(e){var a=e.chatroomId,n=e.newMessage;t({type:y,payload:{chatroomId:a,newMessage:n}})}))}),[]),Object(r.useEffect)((function(){var t;s(null===(t=e.chatroomInfoList)||void 0===t?void 0:t.map((function(e){var t=e.messageList.slice(-1)[0];return{id:e.id,name:e.name,recentMessage:null===t||void 0===t?void 0:t.message,recentMessageUsername:null===t||void 0===t?void 0:t.username}})))}),[e.chatroomInfoList]),o.a.createElement("div",{className:S.a.container},(null===c||void 0===c?void 0:c.length)?c.map((function(t){var a;return o.a.createElement(U,Object.assign({},t,{key:t.id,handleChangeChatroom:i,isActive:(null===(a=e.currentChatroom)||void 0===a?void 0:a.id)===t.id}))})):"\u6b63\u5728\u8bf7\u6c42\u623f\u95f4\u5217\u8868")},J=a(169),K=a.n(J),Q=function(e){var t,a=Object(r.useContext)(N);return o.a.createElement("div",{className:K.a.container},null===(t=a.currentChatroom)||void 0===t?void 0:t.name)},V=a(170),D=a.n(V),G=function(e){var t=Object(r.useContext)(N),a=(Object(r.useContext)(x),e.uid),n=e.username,c=e.message;return o.a.createElement("div",{className:a===t.userInfo.uid?"message-item is-me":"message-item"},o.a.createElement("div",{className:"message-item-username"},n),o.a.createElement("pre",{className:"message-item-message"},c))},z=function(){var e,t=Object(r.useContext)(N),a=(Object(r.useContext)(x),Object(r.useRef)(null));return Object(r.useEffect)((function(){var e,t;null===(e=a.current)||void 0===e||null===(t=e.lastElementChild)||void 0===t||t.scrollIntoView()})),o.a.createElement("div",{className:D.a.container,ref:a},null===(e=t.currentChatroom)||void 0===e?void 0:e.messageList.map((function(e){return o.a.createElement(G,Object.assign({},e,{key:e.messageId}))})))},B=a(171),W=a.n(B),X=a(361),Z=a(363),Y=a(187),$=function(e){var t=Object(r.useContext)(N),a=(Object(r.useContext)(x),X.a.useForm()),n=Object(m.a)(a,1)[0];Object(r.useEffect)((function(){n.resetFields()}),[t.currentChatroom]);return o.a.createElement("div",{className:W.a.container},o.a.createElement(X.a,{form:n,name:"add-message",onFinish:function(e){var a=e.message;t.socket.emit("user-send-message",{chatroomId:t.currentChatroom.id,messageObj:Object(h.a)(Object(h.a)({},t.userInfo),{},{message:a})}),n.resetFields()}},o.a.createElement(X.a.Item,{name:"message",label:""},o.a.createElement(Z.a.TextArea,{placeholder:"\u8f93\u5165\u4fe1\u606f\uff0c\u6309 Enter \u63d0\u4ea4",bordered:!1,onKeyPress:function(e){"Enter"===e.key&&n.submit()}})),o.a.createElement(X.a.Item,null,o.a.createElement(Y.a,{type:"primary",htmlType:"submit"},"\u53d1\u9001"))))},ee=a(99),te=a.n(ee),ae=function(e){var t,a=Object(r.useContext)(N),n=Object(r.useRef)(null),c=Object(f.e)();return(null===(t=a.userInfo)||void 0===t?void 0:t.uid)||c.push("/login"),Object(r.useEffect)((function(){a.socket.on(v,(function(){var e;null===(e=n.current)||void 0===e||e.play()}))}),[]),o.a.createElement("div",{className:te.a.home},o.a.createElement("audio",{id:"my-message-sound",ref:n},o.a.createElement("source",{src:"https://cdn.jsdelivr.net/gh/SHERlocked93/pic@master/new-message.mp3",type:"audio/mpeg"})),o.a.createElement("div",{className:te.a.container},o.a.createElement(k,null),o.a.createElement(H,null),a.currentChatroom?o.a.createElement("div",{className:te.a.room},o.a.createElement(Q,null),o.a.createElement(z,null),o.a.createElement($,null)):o.a.createElement("div",null)))},ne=a(185),re=a(116),oe=a.n(re),ce=a(362),se=a(366),ie=ce.a.TabPane,le="last_login_username",me=function(e){var t=e.history,a=(Object(r.useContext)(N),Object(r.useContext)(x)),n=X.a.useForm(),c=Object(m.a)(n,1)[0],s=X.a.useForm(),i=Object(m.a)(s,1)[0],l=Object(r.useState)("login"),u=Object(m.a)(l,2),d=u[0],f=u[1],b=Object(r.useState)(localStorage.getItem(le)||""),h=Object(m.a)(b,2),p=h[0],v=h[1],E=function(){return c.resetFields()},g=function(){return i.resetFields()};Object(r.useEffect)((function(){a({type:j})}),[]);var O={labelCol:{span:8},wrapperCol:{span:16}},_={wrapperCol:{offset:8,span:16}};return o.a.createElement("div",{className:oe.a.container},o.a.createElement(ce.a,{defaultActiveKey:"login",activeKey:d,className:oe.a.tab,onChange:function(e){f(e),"login"===e?g():E()}},o.a.createElement(ie,{tab:"\u767b\u5f55",key:"login"},o.a.createElement(X.a,Object.assign({name:"login",form:c},O,{initialValues:{remember:!0,username:p},onFinish:function(e){var n=e.remember,r=e.username,o=e.password;n&&window.localStorage.setItem(le,r),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.username,a=e.password;return A({method:"post",url:"/login",data:{username:t,password:a}})}({username:r,password:o}).then((function(e){a({type:C,payload:{userInfo:e}}),t.push("/")})).catch((function(e){return console.error("Error: \u767b\u5f55\u51fa\u9519 ",e)}))}}),o.a.createElement(X.a.Item,{label:"\u7528\u6237\u540d\uff1a",name:"username",tooltip:"\u9009\u4e2d\u300c\u8bb0\u4f4f\u6211\u300d\u4e0b\u6b21\u5c06\u81ea\u52a8\u586b\u5199\u7528\u6237\u540d",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}]},o.a.createElement(Z.a,null)),o.a.createElement(X.a.Item,{label:"\u5bc6\u7801\uff1a",name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}]},o.a.createElement(Z.a.Password,null)),o.a.createElement(X.a.Item,Object.assign({name:"remember",valuePropName:"checked"},_),o.a.createElement(se.a,null,"\u8bb0\u4f4f\u6211")),o.a.createElement(X.a.Item,_,o.a.createElement(Y.a,{type:"primary",htmlType:"submit"},"\u63d0\u4ea4"),o.a.createElement(Y.a,{htmlType:"button",onClick:E},"\u91cd\u7f6e")))),o.a.createElement(ie,{tab:"\u6ce8\u518c",key:"regist"},o.a.createElement(X.a,Object.assign({name:"regist",form:i},O,{onFinish:function(e){var t=e.username;(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.username,a=e.password;return A({method:"post",url:"/regist",data:{username:t,password:a}})})(e).then((function(){window.localStorage.setItem(le,t),v(t),f("login"),g(),c.setFieldsValue({remember:!0,username:t}),M.b.success("\u6ce8\u518c\u6210\u529f\uff0c\u73b0\u5728\u767b\u5f55\u5427")})).catch((function(e){return console.error("Error: \u6ce8\u518c\u5931\u8d25 ",e)}))}}),o.a.createElement(X.a.Item,{label:"\u7528\u6237\u540d\uff1a",name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}]},o.a.createElement(Z.a,null)),o.a.createElement(X.a.Item,{label:"\u5bc6\u7801\uff1a",name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}]},o.a.createElement(Z.a.Password,null)),o.a.createElement(X.a.Item,{label:"\u786e\u8ba4\u5bc6\u7801\uff1a",name:"passwordConfirm",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u786e\u8ba4\u5bc6\u7801"},function(e){var t=e.getFieldValue;return{validator:function(e,a){return t("password")===a?Promise.resolve():Promise.reject(new Error("The two passwords that you entered do not match!"))}}}]},o.a.createElement(Z.a.Password,null)),o.a.createElement(X.a.Item,_,o.a.createElement(Y.a,{type:"primary",htmlType:"submit"},"\u63d0\u4ea4"),o.a.createElement(Y.a,{htmlType:"button",onClick:g},"\u91cd\u7f6e"))))))},ue=function(){var e=Object(r.useReducer)(w,O),t=Object(m.a)(e,2),a=t[0],n=t[1];return o.a.createElement("div",{className:"App"},o.a.createElement(N.Provider,{value:a},o.a.createElement(x.Provider,{value:n},o.a.createElement(ne.a,null,o.a.createElement(f.a,{path:"/",component:ae,exact:!0}),o.a.createElement(f.a,{path:"/login",component:me})))))};a(359);l.a.locale("zh-cn"),s.a.render(o.a.createElement(ue,null),document.getElementById("root"))},71:function(e,t,a){e.exports={container:"chatroomList_container__2W5ti",chatroomItem:"chatroomList_chatroomItem__14Zl_","is-active":"chatroomList_is-active__1wiqM",header:"chatroomList_header__i8Qzy",content:"chatroomList_content__nlkKM"}},99:function(e,t,a){e.exports={home:"home_home__pD-Dm",container:"home_container__1QSs2",room:"home_room__1yo36"}}},[[360,1,2]]]);
//# sourceMappingURL=main.9d0a99f4.chunk.js.map